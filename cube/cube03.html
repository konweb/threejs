<!DOCTYPE html>
<html lang="en"></html>
<head>
  <meta charset="UTF-8">
  <title>Threejs cube01 Sample</title>
</head>
<body>
  <h1>キューブを複数描画</h1>
  <ul>
    <li><a href="../index.html">HOME</a></li>
    <li><a href="../cube/cube01.html">cube01</a></li>
    <li><a href="../cube/cube02.html">cube02</a></li>
    <li><a href="../cube/cube03.html">cube03</a></li>
    <li><a href="../line/line01.html">line01</a></li>
    <li><a href="../line/line02.html">line02</a></li>
    <li><a href="../line/line03.html">line03</a></li>
    <li><a href="../circle/circle01.html">circle01</a></li>
    <li><a href="../circle/circle02.html">circle02</a></li>
    <li><a href="../demo/circle2d-animation.html">DEMO: circle2d-animation</a></li>
    <li><a href="../demo/buffer-geometry.html">DEMO: buffer-geometry</a></li>
  </ul>
  <script src="../common/threejs/build/three.min.js"></script>
  <script>
    var requestAnimationFrame = window.requestAnimationFrame ||
                                window.mozRequestAnimationFrame ||
                                window.webkitRequestAnimationFrame ||
                                window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;

    window.addEventListener("DOMContentLoaded", function(){
        var camera,scene,group,cubeMesh,renderer;
        init();
        animation();

        function init(){
        	/* カメラを用意
        	 * THREE.PerspectiveCamera(画角, 縦横比, クリッピング手前, クリッピング奥);
        	 * クリッピング手前からクリッピング奥までが描画される
        	*/
        	var width = window.innerWidth,
    			height = window.innerHeight,
    			fov = 80,
    			aspect = width / height,
    			near = 80,
    			far = 1000;

			camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
        	// z方向に500ずらす
        	camera.position.z = 500;
    
        	/*
        	 * シーンの準備
        	 * シーンは空間
        	 * ここにオブジェクトを詰め込んでいく
        	*/
        	scene = new THREE.Scene();


            group = new THREE.Object3D();
            scene.add(group);


        	/*
        	 * メッシュの作成
        	 * メッシュはポリゴンの集合で作られたオブジェクト
        	 * メッシュはジオメトリ(座標)とマテリアル(素材)で構成される
        	*/
            
            for(var i = 0;i < 300;i++){
            	// ジオメトリの作成
            	// THREE.CubeGeometry(横幅, 高さ, (横の分割数, 縦の分割数, 奥行きの分割数, 表面, sides));
            	var geometry = new THREE.CubeGeometry(20, 20, 20);
            
            	// マテリアルの作成
            	// THREE.MeshLambertMaterial({object});
            	var material = new THREE.MeshBasicMaterial({
                    color: Math.random() * 0xffffff,
                    transparent: true,
                    opaticy: 0.5
                });
            
            	// メッシュの作成
                var area = 300;
            	cubeMesh = new THREE.Mesh(geometry, material);
                cubeMesh.position.x = Math.random() * area - area/2;
                cubeMesh.position.y = Math.random() * area - area/2;
                cubeMesh.position.z = Math.random() * area - area/2;
            	cubeMesh.rotation.x = Math.random() * area - area/2;
            	cubeMesh.rotation.y = Math.random() * area - area/2;
            	group.add(cubeMesh);
            }
        	/*
        	 * 光源の作成
        	*/
        	var directionalLight = new THREE.DirectionalLight(0xffffff, 3);
        	directionalLight.position.z = 3;
        	/*
        	 * 光源をシーンに追加
        	*/
        	scene.add(directionalLight);
            
        	/*
        	 * レンダラーの用意
        	 * 描画を行う準備
        	*/
        	renderer = new THREE.WebGLRenderer();
        	// 大きさの定義
        	// レンダラー.setSize(横幅, 高さ);
        	renderer.setSize(width, height);
        	// DOMにcanvasを追加
        	document.body.appendChild(renderer.domElement);
            
            render();
            console.log(cubeMesh);
        }
    
        var radius = 600;
        var theta = 0;
        function render(){
            theta += 0.1;
            camera.position.x = radius * Math.sin( THREE.Math.degToRad( theta ) );
            camera.position.y = radius * Math.sin( THREE.Math.degToRad( theta ) );
            camera.position.z = radius * Math.cos( THREE.Math.degToRad( theta ) );
            camera.lookAt( scene.position );
            cubeMesh.rotation.x = radius * Math.sin( THREE.Math.degToRad( theta ) );
            cubeMesh.rotation.y = radius * Math.sin( THREE.Math.degToRad( theta ) );
            group.add(cubeMesh);
            /*
             * レンダリング
             * 描画処理
            */
            renderer.render(scene, camera);
        }

        function animation(){
            requestAnimationFrame(animation);
            render();
        }
    });
  </script>
</body>