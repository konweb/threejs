<!DOCTYPE html>
<html lang="en"></html>
<head>
  <meta charset="UTF-8">
  <title>Threejs Cannonjs Sample</title>
</head>
<body>
  <h1>cannon.js</h1>
  <ul>
    <li><a href="../index.html">HOME</a></li>
    <li><a href="../cube/cube01.html">cube01</a></li>
    <li><a href="../cube/cube02.html">cube02</a></li>
    <li><a href="../cube/cube03.html">cube03</a></li>
    <li><a href="../line/line01.html">line01</a></li>
    <li><a href="../line/line02.html">line02</a></li>
    <li><a href="../line/line03.html">line03</a></li>
    <li><a href="../line/line04.html">line04</a></li>
    <li><a href="../circle/circle01.html">circle01</a></li>
    <li><a href="../circle/circle02.html">circle02</a></li>
    <li><a href="../particle/particle01.html">particle01</a></li>
    <li><a href="../uniqe/uniqe01.html">uniqe01</a></li>
    <li><a href="../uniqe/uniqe02.html">uniqe02</a></li>
    <li><a href="../uniqe/uniqe03.html">uniqe03</a></li>
    <li><a href="../physics/physics01.html">physics01</a></li>
    <li><a href="../other/other01.html">other01</a></li>
    <li><a href="../other/other02.html">other02</a></li>
    <li><a href="../helper/helper01.html">helper01</a></li>
    <li><a href="../demo/circle2d-animation.html">DEMO: circle2d-animation</a></li>
    <li><a href="../demo/buffer-geometry.html">DEMO: buffer-geometry</a></li>
  </ul>
  <script src="../common/threejs/build/three.min.js"></script>
  <script src="../common/lib/ConvexGeometry.js"></script>
  <script src="../common/lib/CanvasRenderer.js"></script>
  <script src="../common/lib/Projector.js"></script>
  <script src="../common/lib/cannon.min.js"></script>
  <script>
    var world, mass, body, shape, timeStep=1/60,
       camera, scene, renderer, geometry, material, mesh;
    initThree();
    initCannon();
    animate();
    function initCannon() {
        // ワールドの設定
        world = new CANNON.World();
    
        // 重力の設定
        world.gravity.set(0,0,0);
        world.broadphase = new CANNON.NaiveBroadphase();
        world.solver.iterations = 10;
    
        // オブジェクトの生成
        shape = new CANNON.Box(new CANNON.Vec3(1,1,1));
        mass = 1;
        body = new CANNON.Body({
          mass: 1
        });
        body.addShape(shape);
        body.angularVelocity.set(0,10,0);
        body.angularDamping = 0.5;
        world.addBody(body);
    }
    function initThree() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100 );
        camera.position.z = 5;
        scene.add( camera );
        geometry = new THREE.BoxGeometry( 1, 1, 1 );
        material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );
        mesh = new THREE.Mesh( geometry, material );
        scene.add( mesh );
        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );
    }
    function animate() {
        requestAnimationFrame( animate );
        updatePhysics();
        render();
    }
    function updatePhysics() {
        // Step the physics world
        world.step(timeStep);
        // Copy coordinates from Cannon.js to Three.js
        mesh.position.copy(body.position);
        mesh.quaternion.copy(body.quaternion);
    }
    function render() {
        renderer.render( scene, camera );
    }
  </script>
</body>